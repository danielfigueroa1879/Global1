import React, { useState, useEffect } from 'react';
import { User, Shield, BookOpen, Calendar, FileText, Bell, Settings, LogOut, Menu, X, Eye, EyeOff, Clock, MapPin, Award, Users, Download, Plus, Edit, Trash2, CheckCircle, AlertCircle } from 'lucide-react';

const GlobalCapacitacionPlatform = () => {
  const [currentUser, setCurrentUser] = useState(null);
  const [activeSection, setActiveSection] = useState('home');
  const [showLogin, setShowLogin] = useState(false);
  const [showPassword, setShowPassword] = useState(false);
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [notifications, setNotifications] = useState([]);

  // Estados para datos mock
  const [guardias, setGuardias] = useState([
    { id: 1, nombre: 'Juan Pérez', rut: '12345678-9', email: 'juan@example.com', estado: 'activo', cursosVencen: 15 },
    { id: 2, nombre: 'María González', rut: '98765432-1', email: 'maria@example.com', estado: 'activo', cursosVencen: 30 }
  ]);

  const [cursos, setCursos] = useState([
    { id: 1, nombre: 'Curso OS-10 Básico', fechaInicio: '2025-09-15', duracion: '40 horas', precio: 150000, estudiantes: 25 },
    { id: 2, nombre: 'Seguridad Industrial', fechaInicio: '2025-09-20', duracion: '60 horas', precio: 200000, estudiantes: 18 }
  ]);

  const [turnos, setTurnos] = useState([
    { id: 1, fecha: '2025-08-29', hora: '08:00-20:00', ubicacion: 'Mall Plaza La Serena', guardia: 'Juan Pérez', estado: 'asignado' },
    { id: 2, fecha: '2025-08-30', hora: '20:00-08:00', ubicacion: 'Edificio Corporativo', guardia: 'María González', estado: 'asignado' }
  ]);

  useEffect(() => {
    // Simular notificaciones
    setNotifications([
      { id: 1, tipo: 'warning', mensaje: 'Curso OS-10 de Juan Pérez vence en 15 días', fecha: '2025-08-28' },
      { id: 2, tipo: 'info', mensaje: 'Nuevo estudiante inscrito en Seguridad Industrial', fecha: '2025-08-28' }
    ]);
  }, []);

  const handleLogin = (email, password, rol) => {
    // Simulación de login
    const user = { 
      id: 1, 
      nombre: rol === 'admin' ? 'Admin Global' : rol === 'guardia' ? 'Juan Pérez' : 'Ana Estudiante',
      email: email, 
      rol: rol 
    };
    setCurrentUser(user);
    setShowLogin(false);
    setActiveSection(rol === 'admin' ? 'dashboard' : rol === 'guardia' ? 'mi-perfil' : 'mis-cursos');
  };

  const LoginForm = () => {
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [rol, setRol] = useState('guardia');

    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div className="bg-white rounded-lg p-8 max-w-md w-full mx-4">
          <div className="flex justify-between items-center mb-6">
            <h3 className="text-2xl font-bold text-gray-800">Iniciar Sesión</h3>
            <button onClick={() => setShowLogin(false)} className="text-gray-500 hover:text-gray-700">
              <X className="w-6 h-6" />
            </button>
          </div>
          
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Tipo de Usuario</label>
              <select 
                value={rol} 
                onChange={(e) => setRol(e.target.value)}
                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
              >
                <option value="guardia">Guardia de Seguridad</option>
                <option value="estudiante">Estudiante</option>
                <option value="admin">Administrador</option>
              </select>
            </div>
            
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
              <input
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                placeholder="tu@email.com"
              />
            </div>
            
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Contraseña</label>
              <div className="relative">
                <input
                  type={showPassword ? 'text' : 'password'}
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 pr-10"
                  placeholder="••••••••"
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute right-3 top-3 text-gray-500 hover:text-gray-700"
                >
                  {showPassword ? <EyeOff className="w-5 h-5" /> : <Eye className="w-5 h-5" />}
                </button>
              </div>
            </div>
            
            <button
              onClick={() => handleLogin(email, password, rol)}
              className="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition-colors"
            >
              Ingresar
            </button>
          </div>
        </div>
      </div>
    );
  };

  const Sidebar = () => {
    const menuItems = {
      admin: [
        { id: 'dashboard', label: 'Dashboard', icon: Settings },
        { id: 'gestionar-guardias', label: 'Gestionar Guardias', icon: Shield },
        { id: 'gestionar-cursos', label: 'Gestionar Cursos', icon: BookOpen },
        { id: 'turnos', label: 'Gestión de Turnos', icon: Calendar },
        { id: 'servicios', label: 'Servicios', icon: FileText },
        { id: 'notificaciones', label: 'Notificaciones', icon: Bell }
      ],
      guardia: [
        { id: 'mi-perfil', label: 'Mi Perfil', icon: User },
        { id: 'mis-turnos', label: 'Mis Turnos', icon: Calendar },
        { id: 'mis-cursos-guardia', label: 'Mis Cursos', icon: BookOpen },
        { id: 'ordenes-trabajo', label: 'Órdenes de Trabajo', icon: FileText },
        { id: 'mi-contrato', label: 'Mi Contrato', icon: FileText }
      ],
      estudiante: [
        { id: 'mis-cursos', label: 'Mis Cursos', icon: BookOpen },
        { id: 'horarios', label: 'Horarios', icon: Calendar },
        { id: 'calificaciones', label: 'Calificaciones', icon: Award },
        { id: 'examen-practica', label: 'Examen de Práctica OS-10', icon: FileText }
      ]
    };

    const items = menuItems[currentUser?.rol] || [];

    return (
      <div className={`fixed inset-y-0 left-0 z-50 w-64 bg-gray-800 transform ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'} transition-transform lg:translate-x-0 lg:static lg:inset-0`}>
        <div className="flex items-center justify-between h-16 px-4 bg-gray-900">
          <h2 className="text-white font-bold text-lg">Global Capacitación</h2>
          <button
            onClick={() => setSidebarOpen(false)}
            className="text-white lg:hidden"
          >
            <X className="w-6 h-6" />
          </button>
        </div>
        
        <nav className="mt-8">
          {items.map((item) => {
            const Icon = item.icon;
            return (
              <button
                key={item.id}
                onClick={() => {
                  setActiveSection(item.id);
                  setSidebarOpen(false);
                }}
                className={`w-full flex items-center px-4 py-3 text-left hover:bg-gray-700 transition-colors ${
                  activeSection === item.id ? 'bg-gray-700 border-r-4 border-blue-500' : ''
                }`}
              >
                <Icon className="w-5 h-5 text-gray-300 mr-3" />
                <span className="text-gray-300">{item.label}</span>
              </button>
            );
          })}
          
          <button
            onClick={() => {
              setCurrentUser(null);
              setActiveSection('home');
              setSidebarOpen(false);
            }}
            className="w-full flex items-center px-4 py-3 text-left hover:bg-gray-700 transition-colors mt-8"
          >
            <LogOut className="w-5 h-5 text-gray-300 mr-3" />
            <span className="text-gray-300">Cerrar Sesión</span>
          </button>
        </nav>
      </div>
    );
  };

  const PublicHome = () => (
    <div className="min-h-screen bg-gradient-to-br from-blue-900 via-blue-800 to-indigo-900">
      {/* Header */}
      <header className="bg-white shadow-lg">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between items-center py-4">
            <div className="flex items-center">
              <Shield className="w-8 h-8 text-blue-600 mr-2" />
              <h1 className="text-2xl font-bold text-gray-800">Global Capacitación Limitada</h1>
            </div>
            <button
              onClick={() => setShowLogin(true)}
              className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors"
            >
              Iniciar Sesión
            </button>
          </div>
        </div>
      </header>

      {/* Hero Section */}
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
        <div className="text-center">
          <h2 className="text-5xl font-bold text-white mb-6">
            Servicios de Seguridad y Capacitación Profesional
          </h2>
          <p className="text-xl text-blue-100 mb-8 max-w-3xl mx-auto">
            Ofrecemos servicios integrales de seguridad privada y programas de capacitación especializados para formar guardias de seguridad certificados.
          </p>
          <div className="flex flex-col sm:flex-row gap-4 justify-center">
            <button className="bg-white text-blue-900 px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
              Solicitar Presupuesto
            </button>
            <button className="border-2 border-white text-white px-8 py-3 rounded-lg font-semibold hover:bg-white hover:text-blue-900 transition-colors">
              Ver Cursos Disponibles
            </button>
          </div>
        </div>
      </div>

      {/* Services Section */}
      <div className="bg-white py-20">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="text-center mb-16">
            <h3 className="text-4xl font-bold text-gray-800 mb-4">Nuestros Servicios</h3>
            <p className="text-xl text-gray-600">Soluciones integrales para su seguridad y capacitación</p>
          </div>
          
          <div className="grid md:grid-cols-2 gap-12">
            <div className="bg-gradient-to-r from-blue-50 to-indigo-50 p-8 rounded-lg">
              <Shield className="w-12 h-12 text-blue-600 mb-4" />
              <h4 className="text-2xl font-bold text-gray-800 mb-4">Servicios de Seguridad</h4>
              <ul className="space-y-2 text-gray-600">
                <li>• Vigilancia en centros comerciales</li>
                <li>• Seguridad corporativa</li>
                <li>• Control de acceso</li>
                <li>• Rondas de seguridad</li>
                <li>• Servicios especiales de eventos</li>
              </ul>
            </div>
            
            <div className="bg-gradient-to-r from-green-50 to-emerald-50 p-8 rounded-lg">
              <BookOpen className="w-12 h-12 text-green-600 mb-4" />
              <h4 className="text-2xl font-bold text-gray-800 mb-4">Capacitación OTEC</h4>
              <ul className="space-y-2 text-gray-600">
                <li>• Curso OS-10 (Guardia de Seguridad)</li>
                <li>• Seguridad Industrial</li>
                <li>• Primeros Auxilios</li>
                <li>• Manejo de Crisis</li>
                <li>• Certificaciones especializadas</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  );

  const AdminDashboard = () => (
    <div className="p-6">
      <h2 className="text-3xl font-bold text-gray-800 mb-8">Panel de Control Administrativo</h2>
      
      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div className="bg-blue-500 text-white p-6 rounded-lg">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-blue-100">Total Guardias</p>
              <p className="text-3xl font-bold">{guardias.length}</p>
            </div>
            <Shield className="w-8 h-8 text-blue-200" />
          </div>
        </div>
        
        <div className="bg-green-500 text-white p-6 rounded-lg">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-green-100">Cursos Activos</p>
              <p className="text-3xl font-bold">{cursos.length}</p>
            </div>
            <BookOpen className="w-8 h-8 text-green-200" />
          </div>
        </div>
        
        <div className="bg-orange-500 text-white p-6 rounded-lg">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-orange-100">Turnos Hoy</p>
              <p className="text-3xl font-bold">{turnos.length}</p>
            </div>
            <Calendar className="w-8 h-8 text-orange-200" />
          </div>
        </div>
        
        <div className="bg-red-500 text-white p-6 rounded-lg">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-red-100">Alertas</p>
              <p className="text-3xl font-bold">{notifications.length}</p>
            </div>
            <Bell className="w-8 h-8 text-red-200" />
          </div>
        </div>
      </div>

      {/* Recent Activity */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div className="bg-white p-6 rounded-lg shadow">
          <h3 className="text-xl font-bold text-gray-800 mb-4">Alertas de Certificaciones</h3>
          <div className="space-y-3">
            {guardias.map(guardia => (
              <div key={guardia.id} className="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                <div>
                  <p className="font-medium text-gray-800">{guardia.nombre}</p>
                  <p className="text-sm text-gray-600">Certificación OS-10 vence en {guardia.cursosVencen} días</p>
                </div>
                <AlertCircle className="w-5 h-5 text-yellow-600" />
              </div>
            ))}
          </div>
        </div>
        
        <div className="bg-white p-6 rounded-lg shadow">
          <h3 className="text-xl font-bold text-gray-800 mb-4">Turnos de Hoy</h3>
          <div className="space-y-3">
            {turnos.map(turno => (
              <div key={turno.id} className="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                <div>
                  <p className="font-medium text-gray-800">{turno.ubicacion}</p>
                  <p className="text-sm text-gray-600">{turno.guardia} - {turno.hora}</p>
                </div>
                <CheckCircle className="w-5 h-5 text-green-600" />
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );

  const GestionGuardias = () => (
    <div className="p-6">
      <div className="flex justify-between items-center mb-8">
        <h2 className="text-3xl font-bold text-gray-800">Gestión de Guardias</h2>
        <button className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center">
          <Plus className="w-5 h-5 mr-2" />
          Nuevo Guardia
        </button>
      </div>
      
      <div className="bg-white rounded-lg shadow overflow-hidden">
        <table className="w-full">
          <thead className="bg-gray-50">
            <tr>
              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Guardia</th>
              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">RUT</th>
              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Certificación</th>
              <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
            </tr>
          </thead>
          <tbody className="bg-white divide-y divide-gray-200">
            {guardias.map(guardia => (
              <tr key={guardia.id}>
                <td className="px-6 py-4 whitespace-nowrap">
                  <div>
                    <div className="text-sm font-medium text-gray-900">{guardia.nombre}</div>
                    <div className="text-sm text-gray-500">{guardia.email}</div>
                  </div>
                </td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{guardia.rut}</td>
                <td className="px-6 py-4 whitespace-nowrap">
                  <span className="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                    {guardia.estado}
                  </span>
                </td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  Vence en {guardia.cursosVencen} días
                </td>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                  <button className="text-blue-600 hover:text-blue-900"><Edit className="w-4 h-4" /></button>
                  <button className="text-red-600 hover:text-red-900"><Trash2 className="w-4 h-4" /></button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );

  const renderContent = () => {
    if (!currentUser) return <PublicHome />;
    
    switch (activeSection) {
      case 'dashboard':
        return <AdminDashboard />;
      case 'gestionar-guardias':
        return <GestionGuardias />;
      case 'mi-perfil':
        return (
          <div className="p-6">
            <h2 className="text-3xl font-bold text-gray-800 mb-8">Mi Perfil</h2>
            <div className="bg-white rounded-lg shadow p-6">
              <div className="flex items-center mb-6">
                <div className="w-20 h-20 bg-blue-500 rounded-full flex items-center justify-center">
                  <User className="w-10 h-10 text-white" />
                </div>
                <div className="ml-6">
                  <h3 className="text-2xl font-bold text-gray-800">{currentUser.nombre}</h3>
                  <p className="text-gray-600">{currentUser.email}</p>
                  <p className="text-sm text-gray-500">Guardia de Seguridad</p>
                </div>
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div className="space-y-4">
                  <h4 className="text-lg font-semibold text-gray-800">Información Personal</h4>
                  <div className="space-y-2">
                    <p><span className="font-medium">RUT:</span> 12.345.678-9</p>
                    <p><span className="font-medium">Teléfono:</span> +56 9 8765 4321</p>
                    <p><span className="font-medium">Fecha de Contratación:</span> 15 Enero 2024</p>
                  </div>
                </div>
                
                <div className="space-y-4">
                  <h4 className="text-lg font-semibold text-gray-800">Estado de Certificaciones</h4>
                  <div className="space-y-2">
                    <div className="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                      <span>Certificación OS-10</span>
                      <span className="text-yellow-600 font-medium">Vence en 15 días</span>
                    </div>
                    <div className="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                      <span>Primeros Auxilios</span>
                      <span className="text-green-600 font-medium">Vigente</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      case 'mis-cursos':
        return (
          <div className="p-6">
            <h2 className="text-3xl font-bold text-gray-800 mb-8">Mis Cursos</h2>
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {cursos.map(curso => (
                <div key={curso.id} className="bg-white rounded-lg shadow p-6">
                  <h3 className="text-xl font-bold text-gray-800 mb-4">{curso.nombre}</h3>
                  <div className="space-y-2 text-gray-600">
                    <p><span className="font-medium">Fecha de Inicio:</span> {curso.fechaInicio}</p>
                    <p><span className="font-medium">Duración:</span> {curso.duracion}</p>
                    <p><span className="font-medium">Progreso:</span> 75%</p>
                  </div>
                  <div className="mt-4 bg-gray-200 rounded-full h-2">
                    <div className="bg-blue-600 h-2 rounded-full" style={{ width: '75%' }}></div>
                  </div>
                  <button className="mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    Continuar Curso
                  </button>
                </div>
              ))}
            </div>
          </div>
        );
      default:
        return (
          <div className="p-6">
            <h2 className="text-3xl font-bold text-gray-800 mb-8">Sección en Desarrollo</h2>
            <div className="bg-white rounded-lg shadow p-6">
              <p className="text-gray-600">Esta sección está siendo desarrollada y estará disponible pronto.</p>
            </div>
          </div>
        );
    }
  };

  return (
    <div className="min-h-screen bg-gray-100">
      {showLogin && <LoginForm />}
      
      {currentUser && (
        <>
          <Sidebar />
          
          {/* Mobile menu button */}
          <div className="lg:hidden fixed top-4 left-4 z-40">
            <button
              onClick={() => setSidebarOpen(true)}
              className="bg-gray-800 text-white p-2 rounded-lg"
            >
              <Menu className="w-6 h-6" />
            </button>
          </div>
          
          {/* Main content */}
          <div className="lg:ml-64">
            <header className="bg-white shadow-sm border-b border-gray-200">
              <div className="px-6 py-4 flex justify-between items-center">
                <h1 className="text-2xl font-bold text-gray-800">
                  Bienvenido, {currentUser.nombre}
                </h1>
                <div className="flex items-center space-x-4">
                  <Bell className="w-6 h-6 text-gray-600" />
                  <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                    <User className="w-5 h-5 text-white" />
                  </div>
                </div>
              </div>
            </header>
            
            <main>
              {renderContent()}
            </main>
          </div>
        </>
      )}
      
      {!currentUser && renderContent()}
    </div>
  );
};

export default GlobalCapacitacionPlatform;
